#!/bin/bash

for i in `ps -e -o pid,cmd | egrep -v grep | grep "inotifywait" | grep "Drive" | awk '{print$1}'`
do
	kill -9 $i
done
pkill -f "/bin/bash /usr/local/indicator-drive/indicator-drive.sh drive-pull"
pkill -f "/bin/bash /usr/local/indicator-drive/indicator-drive.sh drive-monitor"
pkill -f "python /usr/local/indicator-drive/indicator-drive.py"

DEPENDENCY1=$(apt-cache search python-appindicator | grep "python-appindicator - " | awk -F " - " '{print $1}')
if [ "$DEPENDENCY1" = "python-appindicator" ]
then
	sudo apt-get install python-appindicator
fi
DEPENDENCY2=$(which zenity | grep -c "bin/zenity")
if [ "$DEPENDENCY2" = "0" ]
then
	sudo apt-get install zenity
fi
DEPENDENCY3=$(which inotifywait | grep -c "bin/inotifywait")
if [ "$DEPENDENCY3" = "0" ]
then
	sudo apt-get install inotifywait
fi

sudo rm -Rf "/usr/local/indicator-drive"
sudo mkdir -p "/usr/local/indicator-drive"
	
sudo cp -f indicator-drive.py /usr/local/indicator-drive/
sudo chown root:root /usr/local/indicator-drive/indicator-drive.py
sudo chmod 755 /usr/local/indicator-drive/indicator-drive.py

sudo cp -f indicator-drive.sh /usr/local/indicator-drive/
sudo chown root:root /usr/local/indicator-drive/indicator-drive.sh
sudo chmod 755 /usr/local/indicator-drive/indicator-drive.sh

sudo cp -f drive.svg /usr/local/indicator-drive/
sudo chown root:root /usr/local/indicator-drive/drive.svg
sudo chmod a+rw /usr/local/indicator-drive/drive.svg
sudo cp -f drive-color.svg /usr/local/indicator-drive/
sudo chown root:root /usr/local/indicator-drive/drive-color.svg
sudo chmod a+r /usr/local/indicator-drive/drive-color.svg
sudo cp -f drive-dark.svg /usr/local/indicator-drive/
sudo chown root:root /usr/local/indicator-drive/drive-dark.svg
sudo chmod a+r /usr/local/indicator-drive/drive-dark.svg
sudo cp -f drive-light.svg /usr/local/indicator-drive/
sudo chown root:root /usr/local/indicator-drive/drive-light.svg
sudo chmod a+r /usr/local/indicator-drive/drive-light.svg

sudo cp -f indicator-drive.desktop /etc/xdg/autostart/
sudo cp -f indicator_drive.desktop /usr/share/applications/

echo "Installation completed. Now indicator-drive is ready to start at every login. But make sure that drive is setup and configured before that."
